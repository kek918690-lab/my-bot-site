<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #09090b; --card: #18181b; --accent: #3b82f6; --green: #10b981; --red: #ef4444; --text: #fafafa; --gold: #f59e0b; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 110px; user-select: none; }
        
        .top-bar { background: rgba(24, 24, 27, 0.9); backdrop-filter: blur(12px); padding: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; border-bottom: 1px solid #27272a; position: sticky; top: 0; z-index: 100; }
        .res-item { text-align: center; background: rgba(255,255,255,0.03); padding: 5px; border-radius: 8px; }
        .res-item span { font-size: 8px; color: #a1a1aa; display: block; }
        .res-item b { color: var(--text); font-size: 11px; }

        .page { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid #27272a; position: relative; }
        .btn { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: 700; cursor: pointer; margin-top: 8px; }
        
        /* –ë–ª–æ–∫ –†–∞–±–æ—á–∏—Ö */
        .workers-panel { text-align: center; margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 15px; }
        .avatars { font-size: 24px; letter-spacing: 5px; margin-bottom: 10px; }
        .shield-icon { position: absolute; top: 15px; right: 15px; font-size: 20px; display: none; filter: drop-shadow(0 0 5px var(--accent)); }
        
        .hp-mini-bg { background: #27272a; height: 8px; border-radius: 4px; overflow: hidden; margin: 10px 0; }
        #hp-mini-fill { background: var(--green); height: 100%; width: 100%; transition: 0.5s; }
        .lvl-tag { font-size: 10px; color: var(--gold); font-weight: bold; text-transform: uppercase; }

        .navbar { position: fixed; bottom: 0; width: 100%; background: #09090b; display: flex; border-top: 1px solid #27272a; padding: 10px 0; z-index: 200; }
        .nav-item { flex: 1; text-align: center; color: #71717a; font-size: 10px; }
        .active-nav { color: var(--accent); font-weight: bold; }
        
        .hire-card { display: flex; justify-content: space-between; align-items: center; background: #27272a; padding: 12px; border-radius: 15px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="res-item"><span>üí∞ –ú–û–ù–ï–¢–´</span><b id="m-money">0</b></div>
        <div class="res-item"><span>üß± –ö–ò–†–ü–ò–ß</span><b id="m-res">0</b></div>
        <div class="res-item" onclick="healWorkers()"><span>üß™ –ú–ï–î–ò–¶–ò–ù–ê</span><b id="m-med">0</b></div>
        <div class="res-item"><span>üçé –ï–î–ê</span><b id="m-food">0</b></div>
        <div class="res-item"><span>‚ú® –ì–ï–†–û–ô</span><b id="m-art-p">0</b></div>
        <div class="res-item"><span>üìú –ö–£–ó–ù–Ø</span><b id="m-art-k">0</b></div>
    </div>

    <div id="p-hire" class="page active">
        <h3>üë• –¶–µ–Ω—Ç—Ä –ù–∞–π–º–∞</h3>
        <div class="card">
            <div class="hire-card">
                <div><b>–ë–æ—Ç-–¥—Ä–æ–Ω</b><br><small style="color:var(--green)">+5 –∫ –¥–æ–±—ã—á–µ</small></div>
                <button class="btn" style="width:100px; margin:0;" onclick="hire('bot', 100)">100 üí∞</button>
            </div>
            <div class="hire-card">
                <div><b>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</b><br><small style="color:var(--green)">+25 –∫ –¥–æ–±—ã—á–µ</small></div>
                <button class="btn" style="width:100px; margin:0; background:var(--gold); color:#000" onclick="hire('player', 600)">600 üí∞</button>
            </div>
        </div>
    </div>

    <div id="p-home" class="page">
        <div class="card">
            <div id="shield-status" class="shield-icon">üõ°Ô∏è</div>
            <h3 id="work-title" style="margin:0; color:#a1a1aa">–ü–†–ï–î–ü–†–ò–Ø–¢–ò–ï</h3>
            
            <div id="setup-view">
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é:</p>
                <button class="btn" onclick="startWork('–ó–∞–≤–æ–¥')">üß± –ó–∞–≤–æ–¥</button>
                <button class="btn" onclick="startWork('–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è')" style="background:var(--green)">üß™ –õ–∞–±–∞</button>
            </div>

            <div id="work-view" style="display:none;">
                <div id="timer" style="font-size: 42px; text-align: center; font-weight: 900; margin: 10px 0;">02:00</div>
                
                <div class="workers-panel">
                    <div class="avatars" id="worker-avatars">üë§</div>
                    <div class="lvl-tag">–£—Ä–æ–≤–µ–Ω—å –∫–æ–º–∞–Ω–¥—ã: <span id="worker-lvl">1</span></div>
                    <div class="hp-mini-bg"><div id="hp-mini-fill"></div></div>
                    <div style="font-size: 10px;">–ó–¥–æ—Ä–æ–≤—å–µ —Ä–∞–±–æ—á–∏—Ö: <span id="hp-text">100</span>%</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            –°–∏–ª–∞ –ì–µ—Ä–æ—è: <b id="p-power" style="color:var(--gold)">10</b> 
            <button class="btn" style="width:auto; float:right; margin:0; padding:5px 10px;" onclick="upgradeHero()">–ê–ü ‚ú®</button>
        </div>
    </div>

    <div id="p-battle" class="page">
        <h3>‚öîÔ∏è –ê—Ä–µ–Ω–∞</h3>
        <button class="btn" style="background:var(--red)" onclick="tg.showAlert('–ë–æ–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...')">–í–°–¢–£–ü–ò–¢–¨ –í –ë–û–ô</button>
    </div>

    <div id="p-settings" class="page">
        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <button class="btn" style="background:var(--red)" onclick="localStorage.clear(); location.reload();">–°–ë–†–û–°–ò–¢–¨ –ü–†–û–ì–†–ï–°–°</button>
    </div>

    <nav class="navbar">
        <div class="nav-item active-nav" onclick="showTab('hire', this)">üë• –ù–∞–π–º</div>
        <div class="nav-item" onclick="showTab('home', this)">üè† –ë–∞–∑–∞</div>
        <div class="nav-item" onclick="showTab('battle', this)">‚öîÔ∏è –ë–æ–π</div>
        <div class="nav-item" onclick="showTab('settings', this)">‚öôÔ∏è –ù–∞—Å—Ç—Ä.</div>
    </nav>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let s = JSON.parse(localStorage.getItem('v5_save')) || { 
            money: 100, res: 0, med: 0, food: 0, artP: 0, artK: 0, 
            power: 10, type: '', timeLeft: 120, hp: 100, shield: 0,
            bots: 0, players: 0
        };

        function save() { localStorage.setItem('v5_save', JSON.stringify(s)); }

        function showTab(name, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('p-' + name).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active-nav'));
            el.classList.add('active-nav');
        }

        function hire(who, price) {
            if (s.money >= price) {
                s.money -= price;
                if(who === 'bot') s.bots++; else s.players++;
                save(); updateUI();
                tg.showAlert("–ù–∞–Ω—è—Ç –Ω–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫!");
            } else { tg.showAlert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); }
        }

        function startWork(t) { s.type = t; s.timeLeft = 120; save(); updateUI(); }
        function upgradeHero() { if(s.artP>=5){s.artP-=5; s.power+=5; save(); updateUI();} }
        function healWorkers() { if(s.med>=50){s.med-=50; s.hp=100; s.shield=900; save(); updateUI();} }

        setInterval(() => {
            if (s.shield > 0) s.shield--; else s.hp = Math.max(0, s.hp - 0.01);
            if(s.type && s.hp > 0) {
                s.timeLeft--;
                if(s.timeLeft <= 0) {
                    s.timeLeft = 120;
                    let bonus = (s.bots * 5) + (s.players * 25);
                    let amt = 50 + bonus;
                    if(s.type === '–ó–∞–≤–æ–¥') s.res += amt;
                    else if(s.type === '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è') s.med += amt;
                    s.money += (30 + (s.players * 10));
                    save();
                }
            }
            updateUI();
        }, 1000);

        function updateUI() {
            document.getElementById('m-money').innerText = Math.floor(s.money);
            document.getElementById('m-res').innerText = s.res;
            document.getElementById('m-med').innerText = s.med;
            document.getElementById('m-food').innerText = s.food;
            document.getElementById('m-art-p').innerText = s.artP;
            document.getElementById('m-art-k').innerText = s.artK;
            document.getElementById('p-power').innerText = s.power;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —Ä–∞–±–æ—á–∏—Ö
            document.getElementById('hp-mini-fill').style.width = s.hp + "%";
            document.getElementById('hp-text').innerText = Math.floor(s.hp);
            document.getElementById('worker-lvl').innerText = 1 + Math.floor((s.bots + s.players)/5);
            document.getElementById('shield-status').style.display = s.shield > 0 ? 'block' : 'none';
            
            // –ê–≤–∞—Ç–∞—Ä–∫–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            let av = "üë§";
            if(s.bots > 0) av += "ü§ñ".repeat(Math.min(s.bots, 3));
            if(s.players > 0) av += "üë®‚Äçüíª".repeat(Math.min(s.players, 3));
            document.getElementById('worker-avatars').innerText = av;

            if(s.type) {
                document.getElementById('setup-view').style.display = 'none';
                document.getElementById('work-view').style.display = 'block';
                document.getElementById('work-title').innerText = s.type.toUpperCase();
                let m = Math.floor(s.timeLeft/60), sc = s.timeLeft%60;
                document.getElementById('timer').innerText = `${m}:${sc<10?'0':''}${sc}`;
            }
        }
        updateUI();
    </script>
</body>
</html>
