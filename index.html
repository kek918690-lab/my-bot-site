<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --bg: #0d0d0d; --card: #161616; --accent: #3498db; 
            --green: #2ecc71; --red: #e74c3c; --text: #ffffff; --gold: #f1c40f; 
        }
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); color: var(--text); 
            margin: 0; padding-bottom: 100px; transition: background 0.3s;
        }
        
        /* –®–∞–ø–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ */
        .top-bar { 
            background: rgba(22, 22, 22, 0.9); backdrop-filter: blur(10px);
            padding: 12px; display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 10px; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100;
        }
        .res-item { text-align: center; }
        .res-item span { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .res-item b { color: var(--gold); font-size: 14px; display: block; }

        .page { display: none; padding: 20px; animation: slideUp 0.3s ease-out; }
        .active { display: block; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ –∫–Ω–æ–ø–∫–∏ */
        .card { 
            background: var(--card); border-radius: 16px; padding: 18px; 
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .btn { 
            background: var(--accent); color: white; border: none; padding: 14px; 
            border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; 
            transition: transform 0.1s, filter 0.2s;
        }
        .btn:active { transform: scale(0.96); }
        .btn:disabled { opacity: 0.3; filter: grayscale(1); }

        /* –ü—Ä–æ–∫–∞—á–∫–∞ –≥–µ—Ä–æ—è */
        .hero-stats { display: flex; align-items: center; justify-content: space-between; }
        .power-val { font-size: 24px; font-weight: 800; color: var(--accent); }

        /* –ö—É–∑–Ω—è */
        .forge-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 15px; }
        .item-row { 
            background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; 
            margin-top: 8px; display: flex; justify-content: space-between; border-left: 3px solid var(--accent);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar { 
            position: fixed; bottom: 0; width: 100%; background: rgba(15,15,15,0.95); 
            display: flex; border-top: 1px solid #222; padding: 12px 0; backdrop-filter: blur(15px);
        }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 11px; font-weight: 600; }
        .active-nav { color: var(--accent); }

        /* –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è */
        .color-dot { width: 30px; height: 30px; border-radius: 50%; display: inline-block; margin-right: 10px; border: 2px solid #fff; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="res-item"><span>üí∞ –ú–æ–Ω–µ—Ç—ã</span><b id="m-money">0</b></div>
        <div class="res-item"><span>üß± –ö–∏—Ä–ø–∏—á</span><b id="m-res">0</b></div>
        <div class="res-item"><span>üß™ –ú–µ–¥.</span><b id="m-med">0</b></div>
        <div class="res-item"><span>üçé –ï–¥–∞</span><b id="m-food">0</b></div>
        <div class="res-item"><span>‚ú® –ì–µ—Ä–æ–π</span><b id="m-art-p">0</b></div>
        <div class="res-item"><span>üìú –ö—É–∑–Ω—è</span><b id="m-art-k">0</b></div>
    </div>

    <div id="p-obj" class="page active">
        <div class="card">
            <div class="hero-stats">
                <div>
                    <span style="color:#888; font-size: 12px;">–£—Ä–æ–≤–µ–Ω—å –°–∏–ª—ã</span>
                    <div class="power-val" id="p-power">10</div>
                </div>
                <button class="btn" style="width: auto; padding: 10px 20px; background: var(--gold); color: #000;" onclick="upgradeHero()">–£–ª—É—á—à–∏—Ç—å (5 ‚ú®)</button>
            </div>
        </div>

        <div id="setup-view">
            <h3>üè¢ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</h3>
            <button class="btn" onclick="startWork('build')">üß± –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∏—Ä–ø–∏—á–Ω—ã–π –∑–∞–≤–æ–¥</button>
            <button class="btn" onclick="startWork('med')" style="margin-top:10px; background:var(--green)">üß™ –û—Ç–∫—Ä—ã—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é</button>
            <button class="btn" onclick="startWork('food')" style="margin-top:10px; background:#e67e22">üçé –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ç–µ–ø–ª–∏—Ü—ã</button>
        </div>

        <div id="work-view" style="display:none; text-align: center;" class="card">
            <h4 id="work-title" style="letter-spacing: 2px; color: #888;">–†–ê–ë–û–¢–ê</h4>
            <div id="timer" style="font-size: 48px; font-weight: 900; margin: 10px 0;">00:00</div>
            <div style="font-size: 12px; color: var(--gold);">–¶–∏–∫–ª –∑–∞–ø—É—â–µ–Ω...</div>
        </div>
    </div>

    <div id="p-market" class="page">
        <h3>üî® –ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –ö—É–∑–Ω–∏—Ü–∞</h3>
        <div class="card">
            <div id="forge-status" style="font-weight: bold; margin-bottom: 10px;">–ì–æ—Ç–æ–≤–∞</div>
            <div class="forge-grid">
                <button class="btn" id="btn-c1" onclick="craft(1)">x1</button>
                <button class="btn" id="btn-c3" onclick="craft(3)">x3</button>
                <button class="btn" id="btn-c5" onclick="craft(5)">x5</button>
            </div>
            <p style="font-size: 11px; color: #555; margin-top: 10px; text-align: center;">–ö—Ä–∞—Ñ—Ç: 500üß± + 1üìú –∑–∞ –ø—Ä–µ–¥–º–µ—Ç. –û—Ç–∫–∞—Ç 3 –º–∏–Ω.</p>
        </div>
        <div id="inv-list"></div>
    </div>

    <div id="p-settings" class="page">
        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div class="card">
            <h4>üé® –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</h4>
            <div style="display: flex; margin-top: 10px;">
                <div class="color-dot" style="background: #3498db;" onclick="changeColor('#3498db')"></div>
                <div class="color-dot" style="background: #f1c40f;" onclick="changeColor('#f1c40f')"></div>
                <div class="color-dot" style="background: #2ecc71;" onclick="changeColor('#2ecc71')"></div>
            </div>
        </div>
        <div class="card">
            <h4>üåì –¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>
            <button class="btn" style="background: #222;" onclick="changeTheme('#0d0d0d', '#161616')">–¢–µ–Ω—å</button>
            <button class="btn" style="background: #1a1c2c; margin-top: 10px;" onclick="changeTheme('#1a1c2c', '#252a41')">–ü–æ–ª–Ω–æ—á—å</button>
        </div>
        <button class="btn" style="background: #444;" onclick="saveData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</button>
    </div>

    <nav class="navbar">
        <div class="nav-item active-nav" id="n-obj" onclick="tab('obj')">üè† –ì–ª–∞–≤–Ω–∞—è</div>
        <div class="nav-item" id="n-market" onclick="tab('market')">‚öîÔ∏è –ö—É–∑–Ω—è</div>
        <div class="nav-item" id="n-settings" onclick="tab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä.</div>
    </nav>

    <script>
        let tg = window.Telegram.WebApp;
        let s = { 
            money: 100, res: 0, med: 0, food: 0, artP: 0, artK: 0,
            power: 10, type: '', timeLeft: 0, forgeReady: 0, inv: [] 
        };

        function tab(name) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('p-' + name).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active-nav'));
            document.getElementById('n-' + name).classList.add('active-nav');
        }

        function startWork(type) {
            s.type = type;
            s.timeLeft = Math.floor(Math.random() * 300) + 300;
            document.getElementById('setup-view').style.display = 'none';
            document.getElementById('work-view').style.display = 'block';
            document.getElementById('work-title').innerText = type.toUpperCase();
        }

        function upgradeHero() {
            if (s.artP >= 5) {
                s.artP -= 5; s.power += 5;
                updateUI();
                tg.showAlert("–°–∏–ª–∞ –≥–µ—Ä–æ—è –≤—ã—Ä–æ—Å–ª–∞ –¥–æ " + s.power + "!");
            } else { tg.showAlert("–ù—É–∂–Ω–æ 5 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≥–µ—Ä–æ—è!"); }
        }

        function craft(count) {
            let resCost = count * 500, artCost = count * 1;
            if (s.res < resCost || s.artK < artCost) return tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!");
            if (Date.now() < s.forgeReady) return tg.showAlert("–ö—É–∑–Ω—è –æ—Å—Ç—ã–≤–∞–µ—Ç!");

            s.res -= resCost; s.artK -= artCost;
            for(let i=0; i<count; i++) {
                let isWeapon = Math.random() > 0.5;
                s.inv.push({
                    type: isWeapon ? "‚öîÔ∏è –û—Ä—É–∂–∏–µ" : "üõ°Ô∏è –ë—Ä–æ–Ω—è",
                    power: Math.floor(Math.random() * 50) + s.power // –°–∏–ª–∞ –∫—Ä–∞—Ñ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–ª—ã –≥–µ—Ä–æ—è
                });
            }
            s.forgeReady = Date.now() + 180000;
            updateUI(); renderInv();
            tg.showAlert("–°–∫—Ä–∞—Ñ—á–µ–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤: " + count);
        }

        function changeColor(hex) {
            document.documentElement.style.setProperty('--accent', hex);
        }

        function changeTheme(bg, card) {
            document.documentElement.style.setProperty('--bg', bg);
            document.documentElement.style.setProperty('--card', card);
        }

        setInterval(() => {
            if(s.type) {
                s.timeLeft--;
                if(s.timeLeft <= 0) {
                    s.timeLeft = 450;
                    if(s.type === 'build') s.res += 30;
                    else if(s.type === 'med') s.med += 30;
                    else s.food += 30;
                    s.money += 15;
                    if(Math.random() < 0.2) s.artK++;
                    if(Math.random() < 0.1) s.artP++;
                }
            }
            updateUI();
        }, 1000);

        function updateUI() {
            document.getElementById('m-money').innerText = s.money;
            document.getElementById('m-res').innerText = s.res;
            document.getElementById('m-med').innerText = s.med;
            document.getElementById('m-food').innerText = s.food;
            document.getElementById('m-art-p').innerText = s.artP;
            document.getElementById('m-art-k').innerText = s.artK;
            document.getElementById('p-power').innerText = s.power;

            let diff = s.forgeReady - Date.now();
            let fStatus = document.getElementById('forge-status');
            if (diff > 0) {
                fStatus.innerText = `‚è≥ –û—Å—Ç—ã–≤–∞–Ω–∏–µ: ${Math.ceil(diff/1000)}—Å`;
                fStatus.style.color = var(--red);
                document.querySelectorAll('[id^="btn-c"]').forEach(b => b.disabled = true);
            } else {
                fStatus.innerText = "üî• –ö—É–∑–Ω—è –≥–æ—Ç–æ–≤–∞";
                fStatus.style.color = "var(--green)";
                document.querySelectorAll('[id^="btn-c"]').forEach(b => b.disabled = false);
            }

            if(s.type) {
                let m = Math.floor(s.timeLeft/60), sc = s.timeLeft%60;
                document.getElementById('timer').innerText = `${m}:${sc < 10 ? '0' : ''}${sc}`;
            }
        }

        function renderInv() {
            let h = '';
            s.inv.slice().reverse().forEach(item => {
                h += `<div class="item-row"><b>${item.type}</b> <span>–ú–æ—â—å: ${item.power}</span></div>`;
            });
            document.getElementById('inv-list').innerHTML = h;
        }

        function saveData() { tg.sendData(JSON.stringify(s)); }
        updateUI();
    </script>
</body>
</html>
